// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

model user {
  id          String        @id @default(uuid())
  createdAt   DateTime      @default(now())
  name        String?
  username    String
  email       String
  bio         String?
  inters      userInterest?
  socials     socials?
  matchFirst  matches[]     @relation("firstUser")
  matchSecond matches[]     @relation("secondUser")

  @@index([id, username, email])
}

model interests {
  interId      Int            @id
  interestName String
  userInters   userInterest[]
}

model userInterest {
  userId     String    @id
  interID    Int       @unique
  user       user      @relation(fields: [userId], references: [id])
  userInters interests @relation(fields: [interID], references: [interId])

  @@unique([userId, interID])
}

model socials {
  userId   String  @id
  linkedin String?
  github   String?
  twitter  String?
  kaggle   String?
  user     user    @relation(fields: [userId], references: [id])

  @@index([userId])
}

model matches {
  matched_at DateTime     @default(now())
  useroneId  String
  usertwoId  String
  statone    Boolean
  stattwo    Boolean
  mfactor    Float
  mstatus    match_status
  userone    user         @relation(fields: [useroneId], references: [id], name: "firstUser")
  usertwo    user         @relation(fields: [usertwoId], references: [id], name: "secondUser")

  @@id([useroneId, usertwoId])
  @@unique([useroneId, usertwoId])
  @@index([useroneId, usertwoId, mstatus])
}

enum match_status {
  MATCHED
  REQUESTED
  SUCCESS
  REJECTED
}
